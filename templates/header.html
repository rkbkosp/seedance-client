{{ define "header" }}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seedance Manager</title>
    <!-- Google Fonts: Roboto & Google Sans (using Open Sans as proxy for 'Expressive') -->
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet">
    <!-- Material Symbols Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Open Sans"', 'Roboto', 'sans-serif'],
                        mono: ['monospace'],
                    },
                    colors: {
                        // MD3 Baseline Purple/Violet Theme
                        'md-sys-color-primary': '#6750A4',
                        'md-sys-color-on-primary': '#FFFFFF',
                        'md-sys-color-primary-container': '#EADDFF',
                        'md-sys-color-on-primary-container': '#21005D',

                        'md-sys-color-secondary': '#625B71',
                        'md-sys-color-secondary-container': '#E8DEF8',
                        'md-sys-color-on-secondary-container': '#1D192B',

                        'md-sys-color-tertiary': '#7D5260',
                        'md-sys-color-tertiary-container': '#FFD8E4',
                        'md-sys-color-on-tertiary-container': '#31111D',

                        'md-sys-color-error': '#B3261E',
                        'md-sys-color-error-container': '#F9DEDC',

                        'md-sys-color-background': '#FFFBFE',
                        'md-sys-color-on-background': '#1C1B1F',

                        'md-sys-color-surface': '#FFFBFE',
                        'md-sys-color-on-surface': '#1C1B1F',
                        'md-sys-color-surface-variant': '#E7E0EC',
                        'md-sys-color-on-surface-variant': '#49454F',
                        'md-sys-color-outline': '#79747E',
                    },
                    borderRadius: {
                        'md3-sm': '8px',
                        'md3-md': '12px',
                        'md3-lg': '16px',
                        'md3-xl': '28px',
                    }
                }
            }
        }
    </script>
    <style>
        /* MD3 Reset & Utilities */
        body {
            font-family: 'Open Sans', 'Roboto', sans-serif;
        }

        .md3-card {
            border-radius: 12px;
            background-color: var(--md-sys-color-surface, #FFFBFE);
            /* Elevation 1 */
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        }

        .md3-card:hover {
            /* Elevation 2 */
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
        }

        .md3-btn-filled {
            background-color: #6750A4;
            color: #FFFFFF;
            border-radius: 20px;
            /* Fully rounded */
            padding: 10px 24px;
            font-weight: 500;
            transition: box-shadow 0.2s;
        }

        .md3-btn-filled:hover {
            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        }

        .md3-btn-tonal {
            background-color: #E8DEF8;
            color: #1D192B;
            border-radius: 20px;
            padding: 10px 24px;
            font-weight: 500;
        }

        .md3-btn-text {
            color: #6750A4;
            font-weight: 500;
            padding: 10px 12px;
            border-radius: 20px;
        }

        .md3-btn-text:hover {
            background-color: rgba(103, 80, 164, 0.08);
        }

        .md3-field {
            background-color: #E7E0EC;
            border-radius: 4px 4px 0 0;
            border-bottom: 2px solid #49454F;
        }

        .md3-field:focus-within {
            border-bottom-color: #6750A4;
        }

        dialog {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }

        dialog[open] {
            opacity: 1;
            transform: scale(1);
        }

        dialog::backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.2s ease-out;
        }

        dialog[open]::backdrop {
            opacity: 1;
        }
    </style>
    <script>
        const i18n_data = {
            "en": {
                "app.title": "Seedance Manager",
                "nav.settings": "Settings",
                "settings.title": "Settings",
                "settings.language": "Language",
                "settings.apikey": "API Key",
                "settings.apikey.placeholder": "Enter new API Key",
                "settings.apikey.hint": "Updating this will restart the client connection. The key is transient.",
                "btn.cancel": "Cancel",
                "btn.save": "Save",
                "btn.delete": "Delete",
                "btn.download": "Download",
                "footer.text": "&copy; 2026 Seedance Client - MD3 Expressive",

                "projects.title": "Projects",
                "projects.subtitle": "Manage your video generation campaigns",
                "projects.create.placeholder": "New Project Name",
                "projects.create.btn": "Create",
                "projects.open": "Open",

                "sb.back": "Back to Projects",
                "sb.scene": "Storyboard",
                "sb.prompt": "Prompt",
                "sb.first_frame": "First Frame",
                "sb.last_frame": "Last Frame",
                "sb.model": "Model",
                "sb.ratio": "Ratio",
                "sb.duration": "Duration",
                "sb.generating": "Generating...",
                "sb.failed": "Generation Failed",
                "sb.start_gen": "Generate Video",
                "sb.new": "Add New Storyboard",
                "sb.desc_placeholder": "Describe your scene in detail...",
                "sb.desc_hint": "Detailed descriptions yield better results.",
                "sb.upload_img": "Upload Image",
                "sb.add_btn": "Add Storyboard",
                "sb.confirm_delete": "Delete this storyboard?",
                "sb.retry": "Retry",
                "sb.edit": "Edit",
                "sb.edit_title": "Edit Storyboard",
                "sb.update_btn": "Update",
                "sb.download_video": "Download Video",
                "sb.download_lastframe": "Download Last Frame",
                "sb.use_as_firstframe": "Use as First Frame"
            },
            "zh": {
                "app.title": "Seedance 管理器",
                "nav.settings": "设置",
                "settings.title": "设置",
                "settings.language": "界面语言",
                "settings.apikey": "API Key",
                "settings.apikey.placeholder": "输入新的 API Key",
                "settings.apikey.hint": "更新此项将重置客户端连接。密钥仅保存在内存中。",
                "btn.cancel": "取消",
                "btn.save": "保存",
                "btn.delete": "删除",
                "btn.download": "下载视频",
                "footer.text": "&copy; 2026 Seedance Client - MD3 Expressive (中文)",

                "projects.title": "项目列表",
                "projects.subtitle": "管理您的视频生成任务",
                "projects.create.placeholder": "新项目名称",
                "projects.create.btn": "创建",
                "projects.open": "打开",

                "sb.back": "返回项目列表",
                "sb.scene": "分镜",
                "sb.prompt": "提示词",
                "sb.first_frame": "首帧 (起始)",
                "sb.last_frame": "尾帧 (结束)",
                "sb.model": "模型",
                "sb.ratio": "比例",
                "sb.duration": "时长",
                "sb.generating": "生成中...",
                "sb.failed": "生成失败",
                "sb.start_gen": "开始生成",
                "sb.new": "添加新分镜",
                "sb.desc_placeholder": "详细描述您的分镜内容...",
                "sb.desc_hint": "描述得越详细，效果越好。",
                "sb.upload_img": "上传图片",
                "sb.add_btn": "添加分镜",
                "sb.confirm_delete": "确定删除该分镜吗？",
                "sb.retry": "重试",
                "sb.edit": "编辑",
                "sb.edit_title": "编辑分镜",
                "sb.update_btn": "更新",
                "sb.download_video": "下载视频",
                "sb.download_lastframe": "下载尾帧",
                "sb.use_as_firstframe": "用作首帧"
            }
        };

        function getLanguage() {
            let lang = localStorage.getItem("seedance_lang");
            if (!lang) {
                // Determine from browser
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.toLowerCase().startsWith("zh")) {
                    lang = "zh";
                } else {
                    lang = "en";
                }
            }
            return lang;
        }

        function setLanguage(lang) {
            localStorage.setItem("seedance_lang", lang);
            applyLanguage();
            // Update selector value if exists
            const sel = document.getElementById("lang-selector");
            if (sel) sel.value = lang;
        }

        function applyLanguage() {
            const lang = getLanguage();
            const data = i18n_data[lang] || i18n_data["en"];

            document.querySelectorAll("[data-i18n]").forEach(el => {
                const key = el.getAttribute("data-i18n");
                if (data[key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = data[key];
                    } else {
                        el.innerHTML = data[key];
                    }
                }
            });

            // Special handling for confirmation dialogs if needed, or just let them remain simple 
            // We can assume confirmation logic is handled inline, we might need a helper for alerts
        }

        window.addEventListener('DOMContentLoaded', () => {
            applyLanguage();
            const sel = document.getElementById("lang-selector");
            if (sel) {
                sel.value = getLanguage();
                sel.addEventListener('change', (e) => {
                    setLanguage(e.target.value);
                });
            }
        });
    </script>
</head>

<body class="bg-md-sys-color-background min-h-screen text-md-sys-color-on-background">
    <!-- Top App Bar -->
    <nav class="bg-md-sys-color-surface shadow-sm mb-6 sticky top-0 z-50">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <a href="/" class="text-2xl font-normal text-md-sys-color-on-surface flex items-center gap-2">
                <span class="material-symbols-outlined">movie_creation</span>
                <span data-i18n="app.title">Seedance Manager</span>
            </a>
            <div>
                <button onclick="document.getElementById('settings-dialog').showModal()"
                    class="md3-btn-text flex items-center gap-2 text-md-sys-color-on-surface-variant hover:bg-md-sys-color-on-surface/5 rounded-full px-4">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"
                        fill="currentColor">
                        <path
                            d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-1 13.5l103 78-110 190-119-50q-11 8-23 15t-24 12l-16 128H370Zm112-260q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm0-80q-25 0-42.5-17.5T422-480q0-25 17.5-42.5T482-540q25 0 42.5 17.5T542-480q0 25-17.5 42.5T482-420Z" />
                    </svg>
                    <span data-i18n="nav.settings">Settings</span>
                </button>
            </div>
        </div>
    </nav>

    <dialog id="settings-dialog" class="p-0 rounded-md3-xl shadow-2xl bg-transparent border-none w-full max-w-md">
        <div class="bg-md-sys-color-surface p-6 rounded-md3-xl">
            <h3 class="text-2xl font-normal text-md-sys-color-on-surface mb-4" data-i18n="settings.title">Settings</h3>

            <div class="mb-6">
                <label class="block text-sm font-medium text-md-sys-color-primary mb-2"
                    data-i18n="settings.language">Language</label>
                <div class="relative">
                    <select id="lang-selector"
                        class="w-full bg-md-sys-color-surface-variant/30 border-b-2 border-md-sys-color-outline px-4 py-3 outline-none focus:border-md-sys-color-primary transition-colors text-md-sys-color-on-surface rounded-t-sm appearance-none">
                        <option value="en">English (US)</option>
                        <option value="zh">简体中文 (Simplified Chinese)</option>
                    </select>
                </div>
            </div>

            <form action="/settings/apikey" method="POST">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-md-sys-color-primary mb-2"
                        data-i18n="settings.apikey">API Key</label>
                    <input type="password" name="api_key" data-i18n="settings.apikey.placeholder"
                        placeholder="Enter new API Key"
                        class="w-full bg-md-sys-color-surface-variant/30 border-b-2 border-md-sys-color-outline px-4 py-3 outline-none focus:border-md-sys-color-primary transition-colors text-md-sys-color-on-surface rounded-t-sm">
                    <p class="text-xs text-md-sys-color-on-surface-variant mt-2" data-i18n="settings.apikey.hint">
                        Updating this will restart the client connection. The key is not stored permanently on disk for
                        security, it resets on restart.
                    </p>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="document.getElementById('settings-dialog').close()"
                        class="md3-btn-text" data-i18n="btn.cancel">Cancel</button>
                    <button type="submit" class="md3-btn-filled" data-i18n="btn.save">Save</button>
                </div>
            </form>
        </div>
    </dialog>

    <div class="container mx-auto px-4 max-w-6xl">
        {{ end }}

        {{ define "footer" }}
    </div>
    <footer
        class="mt-12 py-8 text-center text-md-sys-color-on-surface-variant text-sm bg-md-sys-color-surface-variant/30"
        data-i18n="footer.text">
        &copy; 2026 Seedance Client - MD3 Expressive
    </footer>
</body>

</html>
{{ end }}